<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Webtoon Tracer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js">
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
            margin: 0;
            padding: 0;
        }
        #loginPage, #dashboard {
            display: none;
            padding: 20px;
        }
        #loginPage {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        .tab-content, .admin-tab-content {
            display: none;
        }
        .active {
            display: block !important;
        }
        .webtoon-card {
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 10px;
            margin: 10px;
            background: #fff;
        }
        .webtoon-card h3 {
            cursor: pointer;
        }
        .favorite-btn.active {
            color: gold;
        }
        #searchInput {
            margin-bottom: 10px;
            padding: 5px;
            width: 300px;
        }
        .btn-notes {
            margin-top: 5px;
            padding: 5px 10px;
        }
    </style>
</head>
<body>

<div id="loginPage">
    <form id="loginForm">
        <input type="email" id="email" placeholder="Email" required><br>
        <input type="password" id="password" placeholder="Mot de passe" required><br>
        <label><input type="checkbox" id="rememberMe"> Se souvenir de moi</label><br>
        <button type="submit">Connexion</button>
        <button type="button" id="createAccountBtn">Cr√©er un compte</button>
        <button type="button" id="forgotPasswordBtn">Mot de passe oubli√©</button>
    </form>
</div>

<div id="dashboard">
    <div>
        <input type="text" id="searchInput" placeholder="Rechercher un webtoon...">
        <button id="clearSearch">Effacer</button>
    </div>
    <div id="searchResults"></div>
    <div id="webtoonsGrid" class="active tab-content"></div>

    <div id="adminSection">
        <button id="addWebtoonBtn">Ajouter un webtoon</button>
        <button id="importExcelBtn">Importer Excel</button>
        <input type="file" id="excelFileInput" accept=".xlsx,.xls" style="display:none;">
        <div id="webtoonsAdminList" class="admin-tab-content"></div>
    </div>
</div>

<!-- Modal Ajouter Webtoon -->
<div id="addWebtoonModal" class="hidden">
    <form id="addWebtoonForm">
        <input type="text" id="newTitle" placeholder="Titre" required><br>
        <input type="text" id="newAuthor" placeholder="Auteur" required><br>
        <input type="text" id="newGenre" placeholder="Genre" required><br>
        <input type="text" id="newPlatform" placeholder="Plateforme" required><br>
        <input type="text" id="newStatus" placeholder="Statut" required><br>
        <input type="number" id="newChapters" placeholder="Chapitres" required><br>
        <input type="number" id="newRating" placeholder="Note (0-100)" required><br>
        <textarea id="newDescription" placeholder="Description"></textarea><br>
        <button type="submit">Ajouter</button>
        <button type="button" id="closeAddModal">Annuler</button>
    </form>
</div>

<!-- Modal Notes -->
<div id="notesModal" class="hidden">
    <textarea id="notesText" placeholder="Vos notes..."></textarea><br>
    <button id="saveNotes">Sauvegarder</button>
    <button id="cancelNotes">Annuler</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script>
class WebtoonTracer {
    constructor() {
        this.users = [
            { id: 1, email: "erisaudrey@gmail.com", password: "password123", isAdmin: true }
        ];
        this.webtoons = [];
        this.favorites = new Set();
        this.searchTerm = '';
        this.isAuthenticated = false;
        this.currentUser = null;

        this.init();
    }

    init() {
        this.setupEventListeners();
        this.loadFromStorage();
        this.checkAutoLogin();
        this.showPage();
    }

    checkAutoLogin() {
        const savedUser = localStorage.getItem('webtoon_user');
        const rememberMe = localStorage.getItem('webtoon_remember_me') === 'true';
        if (savedUser && rememberMe) {
            try { this.currentUser = JSON.parse(savedUser); this.isAuthenticated = true; } 
            catch(e){ localStorage.removeItem('webtoon_user'); localStorage.removeItem('webtoon_remember_me'); }
        }
    }

    showPage() {
        const loginPage = document.getElementById('loginPage');
        const dashboard = document.getElementById('dashboard');
        if (this.isAuthenticated) {
            loginPage.style.display = 'none';
            dashboard.style.display = 'block';
            this.renderWebtoons();
        } else {
            loginPage.style.display = 'flex';
            dashboard.style.display = 'none';
        }
    }

    setupEventListeners() {
        const loginForm = document.getElementById('loginForm');
        const createAccountBtn = document.getElementById('createAccountBtn');
        const forgotPasswordBtn = document.getElementById('forgotPasswordBtn');
        const searchInput = document.getElementById('searchInput');
        const clearSearch = document.getElementById('clearSearch');
        const addWebtoonBtn = document.getElementById('addWebtoonBtn');
        const importExcelBtn = document.getElementById('importExcelBtn');
        const excelFileInput = document.getElementById('excelFileInput');

        loginForm.addEventListener('submit', e => this.handleLogin(e));
        createAccountBtn.addEventListener('click', () => this.handleCreateAccount());
        forgotPasswordBtn.addEventListener('click', () => this.handleForgotPassword());

        searchInput.addEventListener('input', e => { this.searchTerm = e.target.value.toLowerCase(); this.renderWebtoons(); });
        clearSearch.addEventListener('click', () => { searchInput.value=''; this.searchTerm=''; this.renderWebtoons(); });

        addWebtoonBtn.addEventListener('click', () => this.openAddModal());
        importExcelBtn.addEventListener('click', () => excelFileInput.click());
        excelFileInput.addEventListener('change', e => this.handleExcelImport(e));

        document.getElementById('closeAddModal').addEventListener('click', () => this.closeAddModal());
        document.getElementById('addWebtoonForm').addEventListener('submit', e => this.handleAddWebtoon(e));
        document.getElementById('saveNotes').addEventListener('click', () => this.saveNotes());
        document.getElementById('cancelNotes').addEventListener('click', () => this.closeNotesModal());
    }

    handleLogin(e) {
        e.preventDefault();
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const rememberMe = document.getElementById('rememberMe').checked;
        const user = this.users.find(u => u.email===email && u.password===password);
        if(user) {
            this.currentUser=user; this.isAuthenticated=true;
            if(rememberMe) { localStorage.setItem('webtoon_user', JSON.stringify(user)); localStorage.setItem('webtoon_remember_me','true'); }
            this.showPage();
        } else { alert('Email ou mot de passe incorrect'); }
    }

    handleCreateAccount() {
        const email = prompt('Email:'); if(!email) return;
        if(this.users.some(u=>u.email===email)) { alert('Compte d√©j√† existant'); return; }
        const password = prompt('Mot de passe:'); if(!password || password.length<6) return;
        const confirm = prompt('Confirmer:'); if(confirm!==password) return;
        this.users.push({ id:this.users.length+1,email,password,isAdmin:false });
        alert('Compte cr√©√© avec succ√®s');
    }

    handleForgotPassword() {
        alert('Fonction mot de passe oubli√© non modifi√©e.');
    }

    openAddModal() { document.getElementById('addWebtoonModal').classList.remove('hidden'); }
    closeAddModal() { document.getElementById('addWebtoonModal').classList.add('hidden'); document.getElementById('addWebtoonForm').reset(); }

    handleAddWebtoon(e) {
        e.preventDefault();
        const newWebtoon = {
            id: this.webtoons.length + 1,
            title: document.getElementById('newTitle').value,
            author: document.getElementById('newAuthor').value,
            genre: document.getElementById('newGenre').value,
            platform: document.getElementById('newPlatform').value,
            status: document.getElementById('newStatus').value,
            chapters: parseInt(document.getElementById('newChapters').value),
            rating: parseInt(document.getElementById('newRating').value),
            description: document.getElementById('newDescription').value,
            image: "üìñ"
        };
        this.webtoons.push(newWebtoon);
        this.saveToStorage();
        this.renderWebtoons();
        this.closeAddModal();
    }

    handleExcelImport(e) {
        const file = e.target.files[0];
        if(!file) return;
        const reader = new FileReader();
        reader.onload = (evt) => {
            const data = new Uint8Array(evt.target.result);
            const workbook = XLSX.read(data,{type:'array'});
            const sheetName = workbook.SheetNames[0];
            const sheet = workbook.Sheets[sheetName];
            const json = XLSX.utils.sheet_to_json(sheet);
            json.forEach((row,i)=>{
                const newWebtoon = {
                    id:this.webtoons.length+1,
                    title:row.Titre||`Webtoon ${i+1}`,
                    author:row.Auteur||'Inconnu',
                    genre:row.Genre||'Divers',
                    platform:row.Plateforme||'Webtoon',
                    status:row.Statut||'En cours',
                    chapters:parseInt(row.Chapitres)||0,
                    rating:parseInt(row.Note)||0,
                    description:row.Description||'',
                    image: "üìñ"
                };
                this.webtoons.push(newWebtoon);
            });
            this.saveToStorage();
            this.renderWebtoons();
        };
        reader.readAsArrayBuffer(file);
        e.target.value='';
    }

    saveToStorage() { localStorage.setItem('webtoon_data', JSON.stringify(this.webtoons)); }
    loadFromStorage() {
        const savedWebtoons = localStorage.getItem('webtoon_data');
        if(savedWebtoons) { try { this.webtoons = JSON.parse(savedWebtoons); } catch(e){} }
    }

    renderWebtoons() {
        const grid = document.getElementById('webtoonsGrid');
        const filtered = this.webtoons.filter(w=>w.title.toLowerCase().includes(this.searchTerm));
        grid.innerHTML = filtered.map(w=>`
            <div class="webtoon-card">
                <div>${w.image}</div>
                <h3>${w.title}</h3>
                <p>${w.description}</p>
                <div>Auteur: ${w.author} | Genre: ${w.genre} | Plateforme: ${w.platform}</div>
                <div>Chapitres: ${w.chapters} | Statut: ${w.status} | Note: ${w.rating}/100</div>
            </div>
        `).join('');
    }
}

const app = new WebtoonTracer();
</script>
</body>
</html>
